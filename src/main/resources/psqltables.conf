CREATE TABLE Users
(
    id SERIAL PRIMARY KEY,
    firstName VARCHAR(30) NOT NULL,
    lastName VARCHAR(30) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(20) UNIQUE NOT NULL,
    hashCombine VARCHAR(60) NOT NULL,
    isActive BOOLEAN DEFAULT TRUE,,
    override_upload_enabled BOOLEAN DEFAULT FALSE,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE PlaidLink
(
    id SERIAL PRIMARY KEY,
    userID INT NOT NULL,
    access_token VARCHAR(255) NOT NULL,
    item_id VARCHAR(255) NOT NULL,
    institution_name VARCHAR(255) NOT NULL,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    requiresUpdate BOOLEAN,
    FOREIGN KEY (userID) REFERENCES Users(id),
    UNIQUE(userID, item_id)
);

CREATE TABLE Categories
(
    id SERIAL PRIMARY KEY,
    plaid_category_id VARCHAR(255),
    plaid_category VARCHAR(255),
    category VARCHAR(125) NOT NULL,
    description VARCHAR(255),
    is_custom BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (userId) REFERENCES Users(id),
    UNIQUE (userId, category)
);

CREATE OR REPLACE FUNCTION initialize_user_categories(user_id BIGINT)
RETURNS void AS $$
BEGIN
    INSERT INTO Categories (userId, category, is_custom, type) VALUES
    (user_id, 'Rent', FALSE, 'SYSTEM'),
    (user_id, 'Order Out', FALSE, 'SYSTEM'),
    (user_id, 'Groceries', FALSE, 'SYSTEM'),
    (user_id, 'Subscription', FALSE, 'SYSTEM'),
    (user_id, 'Other', FALSE, 'SYSTEM'),
    (user_id, 'Electric', FALSE, 'SYSTEM'),
    (user_id, 'Payment', FALSE, 'SYSTEM'),
    (user_id, 'Haircut', FALSE, 'SYSTEM'),
    (user_id, 'Trip', FALSE, 'SYSTEM'),
    (user_id, 'Gas Bill', FALSE, 'SYSTEM'),
    (user_id, 'Gas', FALSE, 'SYSTEM'),
    (user_id, 'Insurance', FALSE, 'SYSTEM'),
    (user_id, 'Phone Insurance', FALSE, 'SYSTEM'),
    (user_id, 'Utilities', FALSE, 'SYSTEM'),
    (user_id, 'Mortgage', FALSE, 'SYSTEM'),
    (user_id, 'Deposit', FALSE, 'SYSTEM'),
    (user_id, 'Coffee', FALSE, 'SYSTEM'),
    (user_id, 'Income', FALSE, 'SYSTEM'),
    (user_id, 'Pet', FALSE, 'SYSTEM'),
    (user_id, 'Refund', FALSE, 'SYSTEM'),
    (user_id, 'Transfer', FALSE, 'SYSTEM'),
    (user_id, 'Withdrawal', FALSE, 'SYSTEM');
END;
$$ LANGUAGE plpgsql;

CREATE TABLE UserCategories
(
    id SERIAL PRIMARY KEY,
    userId BIGINT NOT NULL,
    category VARCHAR(255) NOT NULL,
    isActive BOOLEAN DEFAULT FALSE,
    type VARCHAR(255) DEFAULT 'CUSTOM',
    is_system_override BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (userId) REFERENCES Users(id),

    UNIQUE(userId, category)
);

CREATE TABLE PlaidCursors
(
    id SERIAL PRIMARY KEY,
    userId INT NOT NULL,
    item_id VARCHAR(225) NOT NULL,
    added_cursor VARCHAR(255) NOT NULL,
    modified_cursor VARCHAR(255) NOT NULL,
    removed_cursor VARCHAR(255) NOT NULL,
    historical_cursor VARCHAR(255) NOT NULL,
    last_sync_timestamp DATE,
    cursor_sync_successful BOOLEAN,
    last_sync_status VARCHAR(255) NOT NULL,
    last_error_message VARCHAR(255) NOT NULL,

    FOREIGN KEY (userId) REFERENCES Users(id)
);

CREATE TABLE Accounts
(
    accountId VARCHAR(255) PRIMARY KEY,
    userId INT NOT NULL,
    accountName VARCHAR(50) NOT NULL,
    officialName VARCHAR(50),
    balance DECIMAL(10, 3) NOT NULL,
    type VARCHAR(20),
    subType VARCHAR(50),
    mask VARCHAR(4) NOT NULL,
    FOREIGN KEY (userId) REFERENCES Users(userId)
);

CREATE TABLE CSVAccounts
(
    id SERIAL PRIMARY KEY,
    userId BIGINT NOT NULL,
    accountName VARCHAR(225) NOT NULL,
    suffix INT NOT NULL,
    accountNumber VARCHAR(25) NOT NULL,
    accountType VARCHAR(225),
    isActive BOOLEAN DEFAULT TRUE,
    UNIQUE(id, accountNumber),
    FOREIGN KEY (userId) REFERENCES Users(id)
);

CREATE TABLE Transactions
(
    transactionId VARCHAR(255) PRIMARY KEY,
    acctId VARCHAR(255) NOT NULL,
    amount DECIMAL(10, 3) NOT NULL,
    description VARCHAR(50),
    posted Date NOT NULL,
    currencycode VARCHAR(5),
    plaid_category_id VARCHAR(255),
    merchantName VARCHAR(75),
    pending BOOLEAN,
    authorizeddate Date NOT NULL,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    logo VARCHAR(100),
    isSystemCategorized BOOLEAN DEFAULT FALSE,
    isCSVTransaction BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (acctId) REFERENCES Accounts(accountId),
    FOREIGN KEY (categoryId) REFERENCES Categories(id)
);

CREATE TABLE CSVTransactions
(
    id SERIAL PRIMARY KEY,
    csvAcctId BIGINT NOT NULL,
    transactionDate Date NOT NULL,
    transactionAmount DECIMAL(10, 3) NOT NULL,
    merchantName VARCHAR(225),
    description VARCHAR(225) NOT NULL,
    extendedDescription VARCHAR(225) NOT NULL,
    electronicTransactionDate Date NOT NULL,
    balance DECIMAL(10, 3),
    category VARCHAR(225),
    isSystemCategorized BOOLEAN DEFAULT FALSE,
    isActive BOOLEAN DEFAULT FALSE,

    FOREIGN KEY (csvAcctId) REFERENCES CSVAccounts(id)
);

CREATE TABLE CSVImports
(
    id SERIAL PRIMARY KEY,
    userId BIGINT NOT NULL,
    title VARCHAR(225) NOT NULL,
    path VARCHAR(365) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (userId) REFERENCES Users(id)

);

CREATE TYPE transaction_type AS ENUM('outflowStreams', 'inflowStreams');

CREATE TABLE RecurringTransactions
(
    rId SERIAL PRIMARY KEY,
    userId INT NOT NULL,
    accountId VARCHAR(50) NOT NULL,
    streamId VARCHAR(50) NOT NULL,
    categoryId VARCHAR(50) NOT NULL,
    description VARCHAR(255) NOT NULL,
    merchantName VARCHAR(255) NOT NULL,
    firstDate Date NOT NULL,
    lastDate Date NOT NULL,
    frequency VARCHAR(50),
    averageAmount DECIMAL(10, 3) NOT NULL,
    lastAmount DECIMAL(10, 3) NOT NULL,
    active BOOLEAN DEFAULT TRUE,
    type VARCHAR(25),
    FOREIGN KEY (userId) REFERENCES Users(id),
    FOREIGN KEY (accountId) REFERENCES Accounts(accountId),
    FOREIGN KEY (categoryId) REFERENCES Categories(categoryId)
);

CREATE TABLE Budgets
(
    budgetId SERIAL PRIMARY KEY,
    userid INT NOT NULL,
    budgetName VARCHAR(225),
    budgetDescription VARCHAR(225),
    totalBudgetAmount DECIMAL(10, 2) NOT NULL,
    budgetActualAmount DECIMAL(10, 2) NOT NULL,
    actualSavingsAllocation DECIMAL(10, 2),
    savingsProgress DECIMAL(10, 3),
    totalMonthsToSave INT,
    budgetMode VARCHAR(50),
    periodType VARCHAR(50),
    monthlyIncome DECIMAL(10, 2) NOT NULL,
    startDate Date NOT NULL,
    endDate Date NOT NULL,
    year INT,
    budgetPeriod VARCHAR(50),
    createdDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    lastUpdatedDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (userid) REFERENCES Users(id)
);

CREATE TABLE UserLogs
(
    logId SERIAL PRIMARY KEY,
    userId INT NOT NULL,
    lastLogin DATE,
    lastLogout DATE,
    loginAttempts INT,
    session_duration INT,
    isActive boolean default FALSE,
    FOREIGN KEY (userId) REFERENCES Users(id)
);


CREATE TABLE SubBudgets
(
    id SERIAL PRIMARY KEY,
    budgetId INT NOT NULL,
    subBudgetName VARCHAR(255),
    allocatedAmount DECIMAL(10, 2),
    spentOnBudget DECIMAL(10, 2),
    subSavingsTarget DECIMAL(10, 2),
    subSavingsAmount DECIMAL(10, 2),
    startDate DATE,
    endDate DATE,
    year INT NOT NULL,
    isActive boolean DEFAULT TRUE,
    FOREIGN KEY (budgetId) REFERENCES budgets(budgetId)
);

CREATE TABLE SubBudgetTrends
(
    id SERIAL PRIMARY KEY,
    subBudgetId BIGINT NOT NULL,
    isSavingsIncreasing BOOLEAN DEFAULT FALSE,
    isIncomeIncreasing BOOLEAN DEFAULT FALSE,
    isSpendingIncreasing BOOLEAN DEFAULT FALSE,

    incomeTrendPercent DOUBLE PRECISION,
    savingsTrendPercent DOUBLE PRECISION,
    spendingTrendPercent DOUBLE PRECISION,
    goalTrendPercent DOUBLE PRECISION,

    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (subBudgetId) REFERENCES SubBudgets(id)
);

CREATE TABLE BudgetSchedules
(
   id SERIAL PRIMARY KEY,
   sub_budgetid INT NOT NULL,
   startDate DATE NOT NULL,
   endDate DATE NOT NULL,
   scheduleRange VARCHAR(67),
   totalPeriods INT,
   periodType VARCHAR(50) NOT NULL,
   status VARCHAR(50) DEFAULT 'ACTIVE',
   createdDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

   FOREIGN KEY (sub_budgetid) REFERENCES SubBudgets(id),
);

CREATE TABLE BudgetScheduleRanges
(
    id SERIAL PRIMARY KEY,
    scheduleId BIGINT NOT NULL,
    rangeStart DATE NOT NULL,
    rangeEnd DATE NOT NULL,
    totalDays INT NOT NULL,
    budgetedAmount DECIMAL(10, 3) NOT NULL,
    spentOnRange DECIMAL(10, 3) NOT NULL,
    rangeType VARCHAR(50),

    FOREIGN KEY (scheduleId) REFERENCES BudgetSchedules(scheduleId)
);

CREATE TABLE BudgetStatistics
(
    id SERIAL PRIMARY KEY,
    subBudgetId INT NOT NULL,
    totalBudget DECIMAL(10, 2),
    totalSpent DECIMAL(10, 2),
    averageSpendingPerDay DECIMAL(10, 2),
    healthScore DECIMAL(10, 2),

    FOREIGN KEY (subBudgetId) REFERENCES SubBudgets(id)
);

CREATE TABLE budget_schedule_mapping (
    budgetId BIGINT NOT NULL,
    scheduleId BIGINT NOT NULL,
    PRIMARY KEY (budgetId, scheduleId),
    FOREIGN KEY (budgetId) REFERENCES budgets(budgetId),
    FOREIGN KEY (scheduleId) REFERENCES budgetSchedules(scheduleId)
);

CREATE TABLE sub_budget_mapping
(
    budgetId BIGINT NOT NULL,
    subBudgetId BIGINT NOT NULL,
    PRIMARY KEY (budgetId, subBudgetId),
    FOREIGN KEY (budgetId) REFERENCES budgets(budgetId),
    FOREIGN KEY (subBudgetId) REFERENCES SubBudgets(id)
);

CREATE TABLE sub_budget_schedule_mapping
(
    subBudgetId BIGINT NOT NULL,
    scheduleId BIGINT NOT NULL,
    PRIMARY KEY (subBudgetId, scheduleId),
    FOREIGN KEY (subBudgetId) REFERENCES subBudgets(id),
    FOREIGN KEY (scheduleId) REFERENCES budgetSchedules(id)
);

CREATE TABLE ControlledSpendingCategories
(
    id SERIAL PRIMARY KEY,
    budgetId INT NOT NULL,
    categoryName VARCHAR(100) NOT NULL,
    allocatedAmount DECIMAL(10, 2),
    monthlySpendingLimit DECIMAL(10, 2),
    currentSpending DECIMAL(10, 2),
    isFixedExpense BOOLEAN DEFAULT FALSE,
    isActive BOOLEAN DEFAULT TRUE,
    priority INT,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (budgetId) REFERENCES Budgets(budgetId)
);

CREATE TABLE TransactionRules
(
    id BIGSERIAL PRIMARY KEY,
    userId BIGINT NOT NULL,
    category VARCHAR(255) NOT NULL,
    merchantRule VARCHAR(255),
    descriptionRule VARCHAR(255),
    extendedDescriptionRule VARCHAR(255),
    amountMin DECIMAL(10, 3),
    amountMax DECIMAL(10, 3),
    isActive BOOLEAN DEFAULT TRUE,
    isManualOverride BOOLEAN DEFAULT FALSE,
    transactionType VARCHAR(255),
    priority INT,
    match_count INT,
    date_created TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    date_modified TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (userId) REFERENCES Users(id)
);

CREATE TABLE BudgetCategories
(
    id BIGSERIAL PRIMARY KEY,
    sub_budgetId INT NOT NULL,
    category_name VARCHAR(255),
    budgetedAmount DECIMAL(10, 2),
    actual DECIMAL(10, 2),
    active BOOLEAN DEFAULT TRUE,
    startDate DATE,
    endDate DATE,
    overspendingAmount DECIMAL(10, 2),
    isOverSpent BOOLEAN DEFAULT FALSE,
    createdat TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (sub_budgetid) REFERENCES SubBudgets(id)
);


CREATE TABLE TransactionCategories
(
    id BIGSERIAL PRIMARY KEY,
    transaction_id VARCHAR(255),
    csv_transaction_id BIGINT,
    sub_budgetId BIGINT,
    matched_category VARCHAR(255) NOT NULL,
    categorized_date DATE,
    categorized_by VARCHAR(50) DEFAULT 'SYSTEM',
    is_categorized BOOLEAN DEFAULT FALSE,
    is_updated BOOLEAN DEFAULT FALSE,
    status VARCHAR(225) DEFAULT 'New',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (transaction_id) REFERENCES Transactions(transactionId),
    FOREIGN KEY (csv_transaction_id) REFERENCES CSVTransactions(id),

    UNIQUE (transaction_id, category),
    UNIQUE (csv_transaction_id, category),
);

CREATE TABLE TransactionCategories_Transactions (
    transactionCategory_id BIGINT,
    transaction_id VARCHAR(255),
    PRIMARY KEY (transactionCategory_id, transaction_id),
    FOREIGN KEY (transactionCategory_id) REFERENCES TransactionCategories(id),
    FOREIGN KEY (transaction_id) REFERENCES Transactions(transactionId)
);

CREATE TABLE BudgetGoals
(
    budget_goals_id SERIAL PRIMARY KEY,
    budgetId INT NOT NULL,
    goalName VARCHAR(255) NOT NULL,
    goalDescription VARCHAR(255),
    goalType VARCHAR(50) NOT NULL,
    targetAmount DECIMAL(10, 2),
    monthlyAllocation DECIMAL(10, 2),
    currentSavings DECIMAL(10, 2),
    savingsFrequency VARCHAR(50),
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status VARCHAR(20) DEFAULT 'In Progress',
    FOREIGN KEY (budgetId) REFERENCES Budgets(budgetId)
);

CREATE TABLE SubBudgetGoals
(
    id SERIAL PRIMARY KEY,
    goalId INT NOT NULL,
    subBudgetId INT NOT NULL,
    monthlySavingsTarget DECIMAL(10, 2),
    monthlyContributed DECIMAL(10, 2),
    goalScore DECIMAL(10, 2),
    remainingAmount DECIMAL(10, 2),
    monthlyStatus VARCHAR(50),

    FOREIGN KEY (goalId) REFERENCES BudgetGoals(id),
    FOREIGN KEY (subBudgetId) REFERENCES SubBudgets(id)
);


CREATE TABLE GroceryReceipts
(
    id SERIAL PRIMARY KEY,
    groceryBudgetId BIGINT NOT NULL,
    description VARCHAR(225),
    storeName VARCHAR(225),
    merchantName VARCHAR(225),
    address VARCHAR(225),
    date DATE,
    price DECIMAL(10, 2),
    total DECIMAL(10, 2),
    total_savings DECIMAL(10, 2),
    number_of_items INT,

    FOREIGN KEY (groceryBudgetId) REFERENCES GroceryBudgets(id)
);

CREATE TABLE GroceryBudgets
(
    id SERIAL PRIMARY KEY,
    budgetScheduleRangeId BIGINT NOT NULL,
    week_number INT,
    startDate DATE,
    endDate DATE,
    budgetedAmount DECIMAL(10, 2),
    totalSpent DECIMAL(10, 2),
    savingsGoal DECIMAL(10, 2),
    health DECIMAL(10, 2),

    FOREIGN KEY (budgetScheduleRangeId) REFERENCES BudgetScheduleRanges(id)
);

CREATE TABLE BP_Templates
(
    id BIGSERIAL PRIMARY KEY,
    sub_budgetId INT NOT NULL,
    goal_id BIGINT NOT NULL,
    bp_goals_detail_id BIGINT NOT NULL,
    bp_template_type VARCHAR(225) NOT NULL,
    template_name VARCHAR(225) NOT NULL,
    template_description VARCHAR(225) NOT NULL,
    active BOOLEAN DEFAULT TRUE,
    is_custom_template BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (sub_budgetId) REFERENCES SubBudgets(id),
    FOREIGN KEY (goal_id) REFERENCES SubBudgetGoals(id),
    FOREIGN KEY (bp_goals_detail_id) REFERENCES BPGoalsDetail(id)
);

CREATE TABLE BP_Category_Details
(
    id BIGSERIAL PRIMARY KEY,
    bp_week_details_id BIGINT NOT NULL,
    category_name VARCHAR(225) NOT NULL,

    budgeted_amount DECIMAL(10, 2),
    planned_amount DECIMAL(10, 2),
    predicted_amount DECIMAL(10, 2),
    actual_amount DECIMAL(10, 2),

    goal_amount DECIMAL(10, 2),
    goal_met_amount DECIMAL(10, 2),
    goal_remaining_amount DECIMAL(10, 2),

    goal_amount_percentage DOUBLE PRECISION,
    goal_met_amount_percentage DOUBLE PRECISION,
    goal_remaining_amount_percentage DOUBLE PRECISION,

    remaining_amount DECIMAL(10, 2),

    spending_percent DECIMAL(10, 2),
    savings_percent DECIMAL(10, 2),
    budgeted_percent DECIMAL(10, 2),

    FOREIGN KEY (bp_week_details_id) REFERENCES BP_Week_Details(id)
);

CREATE TABLE BP_Week_Details
(
    id BIGSERIAL PRIMARY KEY,
    bp_template_detail_id BIGINT NOT NULL,

    week_period VARCHAR(225) NOT NULL,
    planned_amount DECIMAL(10, 2) NOT NULL,
    actual_amount DECIMAL(10, 2) NOT NULL,
    predicted_amount DECIMAL(10, 2),

    goal_amount DECIMAL(10, 2),
    goal_met_amount DECIMAL(10, 2),
    goal_remaining_amount DECIMAL(10, 2),

    goal_amount_percentage DOUBLE PRECISION,
    goal_met_amount_percentage DOUBLE PRECISION,
    goal_remaining_amount_percentage DOUBLE PRECISION,

    remaining_amount DECIMAL(10, 2),
    spending_percent DECIMAL(10, 2),
    savings_percent DECIMAL(10, 2),
    budgeted_percent DECIMAL(10, 2),

    balance DECIMAL(10, 2),

    FOREIGN KEY (bp_template_detail_id) REFERENCES BP_Template_Details(id)
);

CREATE TABLE BP_Template_Details
(
    id BIGSERIAL PRIMARY KEY,
    bp_template_id INT NOT NULL,
    bp_type_name VARCHAR(225) NOT NULL,
    isSavingsFiftyThirtyTwentyApplied BOOLEAN DEFAULT FALSE,

    FOREIGN KEY (bp_template_id) REFERENCES BP_Templates(id)
);

CREATE TABLE BP_Goals_Detail
(
    id BIGSERIAL PRIMARY KEY,
    bp_template_id BIGINT NOT NULL,
    sub_budget_goals_id BIGINT NOT NULL,
    goal_amount DECIMAL(10, 2) NOT NULL,
    total_planned DECIMAL(10, 2) NOT NULL,
    total_spent DECIMAL(10, 2) NOT NULL,
    savings_percent NUMERIC(10, 2),
    spent_over_budget_percent NUMERIC(10, 2),

    FOREIGN KEY (bp_template_id) REFERENCES BP_Templates(id),
    FOREIGN KEY (sub_budget_goals_id) REFERENCES SubBudgetGoals(budget_goals_id)
);

CREATE TABLE BPTemplateHeaders
(
    id BIGSERIAL PRIMARY KEY,
    bp_template_id BIGINT NOT NOT NULL,
    header_name VARCHAR(225) NOT NULL,

    FOREIGN KEY (bp_template_id) REFERENCES BP_Templates(id)
);

// OLD BUDGETS table

// New Budgets TABLE
CREATE TABLE Budgets
(
    budgetId SERIAL PRIMARY KEY,
    userId INT NOT NULL,
    budgetName VARCHAR(225),
    budgetDescription VARCHAR(225),
    budgetActualAmount DECIMAL(10, 3),
    startDate DATE NOT NULL,
    endDate DATE NOT NULL,
    budgetMode ENUM (''),
    budgetYear INT NOT NULL,
    monthlyIncome DECIMAL(10, 3),
    periodType VARCHAR(50) NOT NULL,
    status VARCHAR(50) DEFAULT 'Active',

    FOREIGN KEY (userId) REFERENCES Users(id)
);

CREATE TABLE Budget_Transactions
(
    id SERIAL,
    budgetId INT NOT NULL,
    transactionId VARCHAR(255) NOT NULL,

    PRIMARY KEY(id),
    UNIQUE(budgetId, transactionid),
    FOREIGN KEY (budgetId) REFERENCES Budgets(budgetId),
    FOREIGN KEY (transactionId) REFERENCES Transactions(transactionId)
);

CREATE TABLE User_Category_Rules
(
    id SERIAL PRIMARY KEY,
    userId INT,
    categoryId VARCHAR(255),
    merchantPattern VARCHAR(255),
    descriptionPattern VARCHAR(255),
    minAmount DECIMAL(10, 2),
    maxAmount DECIMAL(10, 2),
    type VARCHAR(50),
    isRecurring BOOLEAN DEFAULT FALSE
);

CREATE OR REPLACE FUNCTION getCategoryName(categoryName VARCHAR(255))
    RETURNS VARCHAR(255) AS $$
BEGIN
    RETURN (
        CASE
            WHEN categoryName = 'Supermarkets and Groceries' THEN 'Groceries'
            WHEN categoryName = 'Gas Stations' THEN 'Gas'
            WHEN categoryName = 'Payroll' THEN 'Income'
            WHEN categoryName = 'Computers and Electronics' THEN 'Electronics'
            WHEN categoryName IN ('Credit Card', 'Subscription', 'Credit', 'Third Party') THEN 'Payments'
            WHEN categoryName = 'Gyms and Fitness Centers' THEN 'Fitness'
            WHEN categoryName IN ('Glasses and Optometrist', 'Pharmacies') THEN 'Health'
            ELSE categoryName
            END
        );
END;
$$ LANGUAGE plpgsql;
